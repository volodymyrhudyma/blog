---
title: "Warning: Can't perform a React state update on an unmounted component"
tag:
  - React
promote: false
metaDescription: Learn how to fix "Can't perform a React state update on an
  unmounted component" warning which notifies that you tried to set the state of
  the component that has already been unmounted.
teaser: This warning is one of the most popular warnings I React developers
  face. I am one hundred percent sure that each developer encountered this at
  least once and did not know why that appeared and how to get rid of it. To
  begin with...
date: 2020-12-02T15:50:00.000Z
---
"**Can't perform a React state update on an unmounted component**" - is one of the most popular warnings I React developers face.

I am one hundred percent sure that each developer encountered this at least once and did not know why that appeared and how to get rid of it.

To begin with, this warning is not something critical and seeing this does not necessarily mean that your application is not working as expected, but for sure the warning should not be omitted.

The warning notifies you that you tried to set the state of the component that has already been unmounted.

## What Happens If I Omit It?

The short answer is - it depends. It may or may not have a huge impact on the performance of React applications.

Let's assume that this warning is generated by the asynchronous call that waits for the completion and sets the local state of the component:

```tsx
const User = () => {
  const [user, setUser] = useState<User | null>(null);

  useEffect(() => {
    setTimeout(() => {
      // The warning is generated by this code
      // If the component unmounts faster than 3s
      setUser({
        id: 1,
        name: "John",
      });
    }, 3000);
  }, []);

  return <div>{user?.name || "No user found"}</div>;
};
```

If only one component missed handling the case of not setting the state after being unmounted, it has almost no impact on the performance.

But if there are a lot of such components (for example, a list) and all of them are not correctly implemented, the impact is huge and the application will be slowed down noticeably.

## Simple Example

A simple example is worth a thousand words, so let's create a simple React application that throws the warning (I will skip all the styles, imports and exports for better readability).

**App.tsx:**

```tsx
const App = () => {
  const [activeView, setActiveView] = useState('project');

  const toggleUser = () => {
    setActiveView('user');
  };

  const toggleProject = () => {
    setActiveView('project');
  };

  return (
    <Wrapper>
      <Button onClick={toggleProject}>Show project</Button>
      <Button onClick={toggleUser}>Show user</Button>
      {activeView === 'user' ? <User /> : <Project />}
    </Wrapper>
  );
};
```

**User.tsx:**

```tsx
const User = () => {
  const [user, setUser] = useState<User | null>(null);

  useEffect(() => {
    setTimeout(() => {
      // The warning is generated by this code
      // If the component unmounts faster than 3s
      setUser({
        id: 1,
        name: "John",
      });
    }, 3000);
  }, []);

  return <div>{user?.name || "No user found"}</div>;
};
```

**Project.tsx:**

```tsx
const Project = () => <div>Project component</div>;
```

The working app looks the following way:

![Working React Application](/img/screenshot-2020-12-01-at-20.01.04.png "Working React Application")

Those buttons at the top act like the tabs, clicking on the first one shown the **Project** component, on the second one - the **User**.

Now open the developers console and click on the "**Show user**" button and then back on the "**Show project**":

![React Application With Warning](/img/ezgif.com-gif-maker-3-.gif "React Application With Warning")

If you manage to do it fast enough (in less than 3 seconds) then the warning will appear in the console.

Why in less than 3 seconds? Because that's the value of the timeout we set on the **User** component, remember?

```tsx
useEffect(() => {
  setTimeout(() => {
    // The warning is generated by this code
    // If the component unmounts faster than 3s
    setUser({
      id: 1,
      name: 'John',
    });
  }, 3000);
}, []);
```

When this component is rendered (after clicking on the "**Show user**" button) the timeout is set, then the component gets unmounted faster than the timeout finishes and we end up with trying to perform **setState** on an unmounted **User** component.

Knowing exactly the place where the issue lies, let's fix it.

## Fixing an Example

The fix is pretty simple - we need to declare a varible `let mounted = true;` inside the **useEffect** hook which will be set to `false` in the cleanup function and check this variable before updating the state:

```tsx
 useEffect(() => {
    // Set to "true" when component is mounted
    let mounted = true;
    setTimeout(() => {
      // Check if the component is still mounted
      if (mounted) {
        setUser({
          id: 1,
          name: 'John',
        });
      }
    }, 3000);
    // Set to "false" when the component is unmounted
    return () => {
      mounted = false;
    };
  }, []);
```

## Summary

"Can't perform a React state update on an unmounted component" warning appears when the developer forgets to check if the component is still mounted before updating its state.

Even though this warning is not a critical error in most cases, it is best to prepare a fix as soon as it appears to make sure that your application is working fine.